<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>mcbrnet • mcbrnet</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="mcbrnet">
<meta property="og:description" content="mcbrnet">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mcbrnet</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.2.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/vignette-mcbrnet.html">mcbrnet</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>mcbrnet</h1>
            
      
      
      <div class="hidden name"><code>vignette-mcbrnet.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="brnet-network-generation">
<code>brnet()</code> : network generation<a class="anchor" aria-label="anchor" href="#brnet-network-generation"></a>
</h2>
<div class="section level3">
<h3 id="basic-usage">Basic usage<a class="anchor" aria-label="anchor" href="#basic-usage"></a>
</h3>
<p>This function generates a random branching network with the specified
number of patches and the probability of branching. The key arguments
are the number of habitat patches (<code>n_patch</code>) and the
probability of branching (<code>p_branch</code>), which users must
specify. With these parameters, the function generates a branching
network through the following steps:</p>
<ol style="list-style-type: decimal">
<li><p>Draw the number of branches in the network. An individual branch
is defined as a series of connected patches from one confluence (or
outlet) to the next confluence upstream (or upstream terminal). The
number of branches in a network <span class="math inline">\(N_{b}\)</span> is drawn from a binomial
distribution as <span class="math inline">\(N_{b} \sim
Binomial(N,P_{b})\)</span>, where <span class="math inline">\(N\)</span>
is the number of patches and <span class="math inline">\(P_b\)</span> is
the branching probability.</p></li>
<li><p>Draw the number of patches in each branch. The number of patches
in branch <span class="math inline">\(q\)</span>, <span class="math inline">\(n_q\)</span>, is drawn from a geometric
distribution as <span class="math inline">\(n_{q} \sim Ge(P_b)\)</span>
but conditional on <span class="math inline">\(\sum_{q}^{N_{b}} n_q =
N\)</span>.</p></li>
<li><p>Organize branches into a bifurcating branching network.</p></li>
</ol>
<p>Sample script:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mcbrnet</span><span class="op">)</span>
<span class="va">net</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/brnet.html">brnet</a></span><span class="op">(</span>n_patch <span class="op">=</span> <span class="fl">50</span>, p_branch <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></code></pre></div>
<p>The function returns:</p>
<ul>
<li><p><code>adjacency_matrix</code>: adjacency matrix.</p></li>
<li><p><code>distance_matrix</code>: distance matrix. Distance between
patches is measured as the number of steps required to reach from the
focal patch to the target patch through the network.</p></li>
<li>
<p><code>df_patch</code>: a data frame (<code><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">dplyr::tibble</a></code>)
containing patch attributes.</p>
<ul>
<li>
<em>patch_id</em>: patch ID.</li>
<li>
<em>branch_id</em>: branch ID.</li>
<li>
<em>environment</em>: environmental value at each patch (see below
for details)</li>
<li>
<em>disturbance</em>: disturbance level (i.e., proportional
mortality) at each patch (see below for details)</li>
<li>
<em>n_patch_upstream</em>: the number of upstream contributing
patches (including the focal patch itself; akin to the watershed area in
river networks).</li>
</ul>
</li>
</ul>
</div>
<div class="section level3">
<h3 id="quick-start">Quick start<a class="anchor" aria-label="anchor" href="#quick-start"></a>
</h3>
<p>The following script produce a branching network with
<code>n_patch = 50</code> and <code>p_branch = 0.5</code>. By default,
<code><a href="../reference/brnet.html">brnet()</a></code> visualizes the generated network using functions in
packages <code>igraph</code> (Csardi and Nepusz 2006) and
<code>plotfunctions</code> (van Rij 2020) (<code>plot = FALSE</code> to
disable):</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mcbrnet</span><span class="op">)</span>
<span class="va">net</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/brnet.html">brnet</a></span><span class="op">(</span>n_patch <span class="op">=</span> <span class="fl">50</span>, p_branch <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></code></pre></div>
<p><img src="vignette-mcbrnet_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p>Randomly generated environmental values color patches and patches’
size is proportional to the number of patches upstream. To view
matrices, type the following script:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># adjacency matrix</span>
<span class="co"># showing 5 patches for example</span>
<span class="va">net</span><span class="op">$</span><span class="va">adjacency_matrix</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>
<span class="co">#&gt;      [,1] [,2] [,3] [,4] [,5]</span>
<span class="co">#&gt; [1,]    0    0    0    0    0</span>
<span class="co">#&gt; [2,]    0    0    1    0    0</span>
<span class="co">#&gt; [3,]    0    1    0    0    0</span>
<span class="co">#&gt; [4,]    0    0    0    0    1</span>
<span class="co">#&gt; [5,]    0    0    0    1    0</span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># distance matrix</span>
<span class="co"># showing 5 patches for example</span>
<span class="va">net</span><span class="op">$</span><span class="va">distance_matrix</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>
<span class="co">#&gt;      [,1] [,2] [,3] [,4] [,5]</span>
<span class="co">#&gt; [1,]    0    4    5    7    8</span>
<span class="co">#&gt; [2,]    4    0    1    7    8</span>
<span class="co">#&gt; [3,]    5    1    0    8    9</span>
<span class="co">#&gt; [4,]    7    7    8    0    1</span>
<span class="co">#&gt; [5,]    8    8    9    1    0</span></code></pre></div>
<p>The following script lets you view branch ID, environmental values,
and the number of upstream contributing patches for each patch:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">net</span><span class="op">$</span><span class="va">df_patch</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 50 x 5</span></span>
<span class="co">#&gt;    patch_id branch_id environment disturbance n_patch_upstream</span>
<span class="co">#&gt;       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>        1         1      -<span style="color: #BB0000;">1.33</span>        0.861               50</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>        2        10      -<span style="color: #BB0000;">1.13</span>        0.967                6</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>        3        10      -<span style="color: #BB0000;">1.05</span>        0.970                5</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>        4         7      -<span style="color: #BB0000;">0.833</span>       0.831               16</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>        5         7      -<span style="color: #BB0000;">0.665</span>       0.848               15</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>        6        13      -<span style="color: #BB0000;">0.890</span>       0.712                5</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>        7        13      -<span style="color: #BB0000;">0.938</span>       0.705                4</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>        8        13      -<span style="color: #BB0000;">0.967</span>       0.727                3</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>        9        13      -<span style="color: #BB0000;">1.06</span>        0.738                2</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span>       10        13      -<span style="color: #BB0000;">1.18</span>        0.728                1</span>
<span class="co">#&gt; <span style="color: #949494;"># ... with 40 more rows</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="customize-visualization">Customize: visualization<a class="anchor" aria-label="anchor" href="#customize-visualization"></a>
</h3>
<p><strong>Arguments:</strong> <code>patch_label</code>,
<code>patch_scaling</code>, <code>patch_size</code></p>
<p>Users may add patch labels using the argument
<code>patch_label</code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># patch ID</span>
<span class="va">net</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/brnet.html">brnet</a></span><span class="op">(</span>n_patch <span class="op">=</span> <span class="fl">50</span>, p_branch <span class="op">=</span> <span class="fl">0.5</span>, patch_label <span class="op">=</span> <span class="st">"patch"</span><span class="op">)</span></code></pre></div>
<p><img src="vignette-mcbrnet_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># branch ID</span>
<span class="va">net</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/brnet.html">brnet</a></span><span class="op">(</span>n_patch <span class="op">=</span> <span class="fl">50</span>, p_branch <span class="op">=</span> <span class="fl">0.5</span>, patch_label <span class="op">=</span> <span class="st">"branch"</span><span class="op">)</span></code></pre></div>
<p><img src="vignette-mcbrnet_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># number of upstream contributing patches</span>
<span class="va">net</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/brnet.html">brnet</a></span><span class="op">(</span>n_patch <span class="op">=</span> <span class="fl">50</span>, p_branch <span class="op">=</span> <span class="fl">0.5</span>, patch_label <span class="op">=</span> <span class="st">"n_upstream"</span><span class="op">)</span></code></pre></div>
<p><img src="vignette-mcbrnet_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
<p>To remove patch size variation, set
<code>patch_scaling = FALSE</code> and specify
<code>patch_size</code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># number of upstream contributing patches</span>
<span class="va">net</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/brnet.html">brnet</a></span><span class="op">(</span>n_patch <span class="op">=</span> <span class="fl">50</span>, p_branch <span class="op">=</span> <span class="fl">0.5</span>, patch_scaling <span class="op">=</span> <span class="cn">FALSE</span>, patch_size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></code></pre></div>
<p><img src="vignette-mcbrnet_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="customize-environment">Customize: environment<a class="anchor" aria-label="anchor" href="#customize-environment"></a>
</h3>
<p><strong>Arguments:</strong> <code>mean_env_source</code>,
<code>sd_env_source</code>, <code>rho</code>,
<code>sd_env_lon</code></p>
<p>Some flexibility exists to simulate environmental values, which are
determined through an autoregressive process, as detailed below:</p>
<ol style="list-style-type: decimal">
<li><p>Environmental values for upstream terminal patches (i.e., patches
with no upstream patch) are drawn from a normal distribution as <span class="math inline">\(z_h \sim N(\mu_{h}, \sigma_h^2)\)</span>
(arguments <code>mean_env_source</code> and
<code>sd_env_source</code>).</p></li>
<li><p>Downstream environmental values are determined by an
autoregressive process as <span class="math inline">\(z_{down} \sim
N(\rho z_{up}, \sigma_l^2)\)</span> (argument <code>sd_env_lon</code>).
At bifurcation patches (or confluence), the environmental value takes a
weighted mean of the two contributing patches given the size of these
patches <span class="math inline">\(N_{up}\)</span> (the number of
upstream contributing patches): <span class="math inline">\(z_{down} =
\omega(\rho z_{up, 1} + \epsilon_1) + (1 - \omega)(\rho z_{up,2} +
\epsilon_2)\)</span>, where <span class="math inline">\(\omega =
\frac{N_{up,1}}{N_{up,1} + N_{up,2}}\)</span> and <span class="math inline">\(\epsilon \sim N(0, \sigma_l^2)\)</span>.</p></li>
</ol>
<p>Users may change the values of <span class="math inline">\(\mu_h\)</span> (default:
<code>mean_env_source = 0</code>), <span class="math inline">\(\sigma_h\)</span>
(<code>sd_env_source = 1</code>), <span class="math inline">\(\rho\)</span> (<code>rho = 1</code>), and <span class="math inline">\(\sigma_l\)</span> (<code>sd_env_lon = 0.1</code>).
Increasing the value of <code>sd_env_source</code> leads to greater
variation in environmental values at upstream terminals. The argument
<code>rho</code> determines the strength of longitudinal autocorrelation
(the greater the stronger autocorrelation). The argument
<code>sd_env_lon</code> determines the strength of longitudinal
environmental noise.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">net</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/brnet.html">brnet</a></span><span class="op">(</span>n_patch <span class="op">=</span> <span class="fl">50</span>, p_branch <span class="op">=</span> <span class="fl">0.5</span>,
             sd_env_source <span class="op">=</span> <span class="fl">3</span>, rho <span class="op">=</span> <span class="fl">0.5</span>, sd_env_lon <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></code></pre></div>
<p><img src="vignette-mcbrnet_files/figure-html/brnet_instruction_2-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="customize-disturbance">Customize: disturbance<a class="anchor" aria-label="anchor" href="#customize-disturbance"></a>
</h3>
<p><strong>Arguments:</strong> <code>mean_disturb_source</code>,
<code>sd_disturb_source</code> , <code>sd_disturb_lon</code></p>
<p>Some flexibility exists to simulate disturbance levels, as detailed
below:</p>
<ol style="list-style-type: decimal">
<li><p>Disturbance levels for upstream terminal patches (i.e., patches
with no upstream patch) are drawn from a normal distribution in a logit
scale as <span class="math inline">\(logit~m_h \sim N(logit~\mu_{m},
\sigma_{h,m}^2)\)</span>. The argument <code>mean_disturb_source</code>
controls the proportional mean of the disturbance level. The argument
<code>sd_disturb_source</code> controls the variation in disturbance
level among headwaters in a logit scale.</p></li>
<li><p>Disturbance cascades downstream as in environmental values: <span class="math inline">\(logit~m_{down} \sim N(logit~m_{up},
\sigma_{l,m}^2)\)</span>. At bifurcation patches (or confluence), the
disturbance value takes a weighted mean of the two contributing patches
given the stream size of these patches <span class="math inline">\(N_{up}\)</span> (the number of upstream
contributing patches): <span class="math inline">\(logit~m_{down} =
\omega(logit~logit~m_{up, 1} + \epsilon_1) + (1 - \omega)(logit~
m_{up,2} + \epsilon_2)\)</span>, where <span class="math inline">\(\omega = \frac{N_{up,1}}{N_{up,1} +
N_{up,2}}\)</span> and <span class="math inline">\(\epsilon \sim N(0,
\sigma_{l,m}^2)\)</span>.</p></li>
</ol>
<p>Users may change the values of <span class="math inline">\(\mu_{m}\)</span>
(<code>mean_disturb_source</code>), <span class="math inline">\(\sigma_{h,m}\)</span>
(<code>sd_disturb_source</code>) and <span class="math inline">\(\sigma_{l,m}\)</span>(<code>sd_disturb_lon</code>).</p>
</div>
</div>
<div class="section level2">
<h2 id="mcsim-metacommunity-simulation">
<code>mcsim()</code> : metacommunity simulation<a class="anchor" aria-label="anchor" href="#mcsim-metacommunity-simulation"></a>
</h2>
<div class="section level3">
<h3 id="basic-usage-1">Basic usage<a class="anchor" aria-label="anchor" href="#basic-usage-1"></a>
</h3>
<p>This function simulates metacommunity dynamics. Community dynamics
are modeled based on the Beverton-Holt function. Although this function
is designed to be compatible with <code><a href="../reference/brnet.html">brnet()</a></code>, users can
provide their distance matrix to simulate dynamics in any landscape. The
key arguments are the number of habitat patches (<code>n_patch</code>)
and the number of species in a metacommunity (<code>n_species</code>).
The metacommunity dynamics are simulated through (1) local dynamics
(population growth and competition among species), (2) immigration, and
(3) emigration.</p>
<p>Sample script:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mcsim.html">mcsim</a></span><span class="op">(</span>n_patch <span class="op">=</span> <span class="fl">5</span>, n_species <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></code></pre></div>
<p>The function returns:</p>
<ul>
<li>
<p><code>df_dynamics</code> a data frame containing simulated
metacommunity dynamics*.</p>
<ul>
<li>
<em>timestep</em>: time-step.</li>
<li>
<em>patch_id</em>: patch ID.</li>
<li>
<em>mean_env</em>: mean environmental condition at each patch.</li>
<li>
<em>env</em>: environmental condition at patch x and time-step
t.</li>
<li>
<em>carrying_capacity</em>: carrying capacity at each patch.</li>
<li>
<em>species</em>: species ID.</li>
<li>
<em>niche_optim</em>: optimal environmental value for species
i.</li>
<li>
<em>r_xt</em>: reproductive number of species i at patch x and
time-step t.</li>
<li>
<em>abundance</em>: abundance of species i at patch x.</li>
</ul>
</li>
<li>
<p><code>df_species</code> a data frame containing species
attributes.</p>
<ul>
<li>
<em>species</em>: species ID.</li>
<li>
<em>mean_abundance</em>: mean abundance (arithmetic) of species i
across sites and time-steps.</li>
<li>
<em>r0</em>: maximum reproductive number of species i.</li>
<li>
<em>niche_optim</em>: optimal environmental value for species
i.</li>
<li>
<em>sd_niche_width</em>: niche width for species i.</li>
<li>
<em>p_dispersal</em>: dispersal probability of species i.</li>
</ul>
</li>
<li>
<p><code>df_patch</code> a data frame containing patch
attributes.</p>
<ul>
<li>
<em>patch</em>: patch ID.</li>
<li>
<em>alpha_div</em>: alpha diversity averaged across time-steps.</li>
<li>
<em>mean_env</em>: mean environmental condition at each patch.</li>
<li>
<em>carrying_capacity</em>: carrying capacity at each patch.</li>
<li>
<em>connectivity</em>: functional connectivity at each patch.</li>
</ul>
</li>
<li><p><code>df_diversity</code> a data frame containing diversity
metrics (α, β, and γ).</p></li>
<li><p><code>distance_matrix</code> a distance matrix used in the
simulation.</p></li>
<li><p><code>interaction_matrix</code> a species interaction matrix, in
which species X (column) influences species Y (row).</p></li>
</ul>
<p>*NOTE: The warm-up and burn-in periods will not be included in return
values.</p>
</div>
<div class="section level3">
<h3 id="quick-start-1">Quick start<a class="anchor" aria-label="anchor" href="#quick-start-1"></a>
</h3>
<p>The following script simulates metacommunity dynamics with
<code>n_patch = 5</code> and <code>n_species = 5</code>. By default,
<code><a href="../reference/mcsim.html">mcsim()</a></code> simulates metacommunity dynamics with 200 warm-up
(initialization with species introductions: <code>n_warmup</code>), 200
burn-in (burn-in period with no species introductions:
<code>n_burnin</code>), and 1000 time-steps for records
(<code>n_timestep</code>).</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mcsim.html">mcsim</a></span><span class="op">(</span>n_patch <span class="op">=</span> <span class="fl">5</span>, n_species <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></code></pre></div>
<p>Users can visualize the simulated dynamics using
<code>plot = TRUE</code>, which will show five sample patches and
species that are randomly chosen:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mcsim.html">mcsim</a></span><span class="op">(</span>n_patch <span class="op">=</span> <span class="fl">5</span>, n_species <span class="op">=</span> <span class="fl">5</span>, plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="vignette-mcbrnet_files/figure-html/unnamed-chunk-19-1.png" width="1056"></p>
<p>A named list of return values:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mc</span>
<span class="co">#&gt; $df_dynamics</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 25,000 x 9</span></span>
<span class="co">#&gt;    timestep patch_id mean_env     env carrying_capacity species niche_optim</span>
<span class="co">#&gt;       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>        1        1        0 -<span style="color: #BB0000;">0.101</span>                100       1     -<span style="color: #BB0000;">0.526</span> </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>        1        1        0 -<span style="color: #BB0000;">0.101</span>                100       2     -<span style="color: #BB0000;">0.696</span> </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>        1        1        0 -<span style="color: #BB0000;">0.101</span>                100       3      0.552 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>        1        1        0 -<span style="color: #BB0000;">0.101</span>                100       4      0.927 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>        1        1        0 -<span style="color: #BB0000;">0.101</span>                100       5      0.071<span style="text-decoration: underline;">7</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>        1        2        0  0.059<span style="text-decoration: underline;">5</span>               100       1     -<span style="color: #BB0000;">0.526</span> </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>        1        2        0  0.059<span style="text-decoration: underline;">5</span>               100       2     -<span style="color: #BB0000;">0.696</span> </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>        1        2        0  0.059<span style="text-decoration: underline;">5</span>               100       3      0.552 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>        1        2        0  0.059<span style="text-decoration: underline;">5</span>               100       4      0.927 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span>        1        2        0  0.059<span style="text-decoration: underline;">5</span>               100       5      0.071<span style="text-decoration: underline;">7</span></span>
<span class="co">#&gt; <span style="color: #949494;"># ... with 24,990 more rows, and 2 more variables: r_xt &lt;dbl&gt;, abundance &lt;dbl&gt;</span></span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $df_species</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 x 6</span></span>
<span class="co">#&gt;   species mean_abundance    r0 niche_optim sd_niche_width p_dispersal</span>
<span class="co">#&gt;     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span>       1           42.2     4     -<span style="color: #BB0000;">0.526</span>           0.625         0.1</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span>       2           29.2     4     -<span style="color: #BB0000;">0.696</span>           0.712         0.1</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span>       3            0       4      0.552           0.141         0.1</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span>       4            0       4      0.927           0.231         0.1</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span>       5           75.0     4      0.071<span style="text-decoration: underline;">7</span>          0.192         0.1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $df_patch</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 x 5</span></span>
<span class="co">#&gt;   patch_id alpha_div mean_env carrying_capacity connectivity</span>
<span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span>        1         3        0               100      0.006<span style="text-decoration: underline;">41</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span>        2         3        0               100      0.110  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span>        3         3        0               100      0.388  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span>        4         3        0               100      0.049<span style="text-decoration: underline;">1</span> </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span>        5         3        0               100      0.365  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $df_diversity</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 x 3</span></span>
<span class="co">#&gt;   alpha_div beta_div gamma_div</span>
<span class="co">#&gt;       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span>         3        1         3</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $df_xy_coord</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 x 2</span></span>
<span class="co">#&gt;   x_coord y_coord</span>
<span class="co">#&gt;     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span>    4.28    1.67</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span>    3.50    6.88</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span>    5.18    8.84</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span>    9.67    8.93</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span>    6.36    9.06</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $distance_matrix</span>
<span class="co">#&gt;          1        2        3        4        5</span>
<span class="co">#&gt; 1 0.000000 5.276909 7.227761 9.047694 7.682947</span>
<span class="co">#&gt; 2 5.276909 0.000000 2.579611 6.508615 3.599554</span>
<span class="co">#&gt; 3 7.227761 2.579611 0.000000 4.494701 1.202414</span>
<span class="co">#&gt; 4 9.047694 6.508615 4.494701 0.000000 3.315017</span>
<span class="co">#&gt; 5 7.682947 3.599554 1.202414 3.315017 0.000000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $interaction_matrix</span>
<span class="co">#&gt;      [,1] [,2] [,3] [,4] [,5]</span>
<span class="co">#&gt; [1,]    1    0    0    0    0</span>
<span class="co">#&gt; [2,]    0    1    0    0    0</span>
<span class="co">#&gt; [3,]    0    0    1    0    0</span>
<span class="co">#&gt; [4,]    0    0    0    1    0</span>
<span class="co">#&gt; [5,]    0    0    0    0    1</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="customize-combine-brnet-and-mcsim">Customize: combine <code>brnet()</code> and
<code>mcsim()</code><a class="anchor" aria-label="anchor" href="#customize-combine-brnet-and-mcsim"></a>
</h3>
<p>Return values of <code><a href="../reference/brnet.html">brnet()</a></code> are compatible with
<code><a href="../reference/mcsim.html">mcsim()</a></code>. For example, <code>df_patch$environment</code>,
<code>df_patch$n_patch_upstream</code>, and
<code>df_patch$distance_matrix</code> may be used to inform parameters
of <code><a href="../reference/mcsim.html">mcsim()</a></code>:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">patch</span> <span class="op">&lt;-</span> <span class="fl">100</span>
<span class="va">net</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/brnet.html">brnet</a></span><span class="op">(</span>n_patch <span class="op">=</span> <span class="va">patch</span>, p_branch <span class="op">=</span> <span class="fl">0.5</span>, plot <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>
<span class="va">mc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mcsim.html">mcsim</a></span><span class="op">(</span>n_patch <span class="op">=</span> <span class="va">patch</span>, n_species <span class="op">=</span> <span class="fl">5</span>,
            mean_env <span class="op">=</span> <span class="va">net</span><span class="op">$</span><span class="va">df_patch</span><span class="op">$</span><span class="va">environment</span>,
            carrying_capacity <span class="op">=</span> <span class="va">net</span><span class="op">$</span><span class="va">df_patch</span><span class="op">$</span><span class="va">n_patch_upstream</span><span class="op">*</span><span class="fl">10</span>,
            distance_matrix <span class="op">=</span> <span class="va">net</span><span class="op">$</span><span class="va">distance_matrix</span>,
            plot <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<p><img src="vignette-mcbrnet_files/figure-html/unnamed-chunk-21-1.png" width="1056"></p>
</div>
<div class="section level3">
<h3 id="customize-detailed-parameters">Customize: detailed parameters<a class="anchor" aria-label="anchor" href="#customize-detailed-parameters"></a>
</h3>
<p>Users may use the following arguments to custom metacommunity
simulations regarding (1) species attributes, (2) competition, (3) patch
attributes, and (4) landscape structure.</p>
<div class="section level4">
<h4 id="species-attributes">Species attributes<a class="anchor" aria-label="anchor" href="#species-attributes"></a>
</h4>
<p><strong>Arguments:</strong> <code>r0</code>, <code>niche_optim</code>
OR <code>min_optim</code> and <code>max_optim</code>,
<code>sd_niche_width</code> OR <code>min_niche_width</code> and
<code>max_niche_width</code>, <code>niche_cost</code>,
<code>p_dispersal</code></p>
<p>Species attributes are determined based on the maximum reproductive
rate <code>r0</code>, optimal environmental value
<code>niche_optim</code> (or <code>min_optim</code> and
<code>max_optim</code> for random generation of
<code>niche_optim</code>), niche width <code>sd_niche_width</code> (or
<code>min_niche_width</code> and <code>max_niche_width</code> for random
generation of <code>sd_niche_width</code>) and dispersal probability
<code>p_dispersal</code> (see <strong>Model description</strong> for
details).</p>
<p>For optimal environmental values (niche optimum), the function by
default assigns random values to species as: <span class="math inline">\(\mu_i \sim Unif(\mu_{min}, \mu_{max})\)</span>,
where users can set values of <span class="math inline">\(\mu_{min}\)</span> and <span class="math inline">\(\mu_{max}\)</span> using <code>min_optim</code>
and <code>max_optim</code> arguments (default:
<code>min_optim = -1</code> and <code>max_optim = 1</code>).
Alternatively, users may specify species niche optimums using the
argument <code>niche_optim</code> (scalar or vector). If a single value
or a vector of <code>niche_optim</code> is provided, the function
ignores <code>min_optim</code> and <code>max_optim</code> arguments.</p>
<p>Similarly, the function by default assigns random values of <span class="math inline">\(\sigma_{niche}\)</span> to species as: <span class="math inline">\(\sigma_{niche,i} \sim Unif(\sigma_{niche,min},
\sigma_{niche,max})\)</span>. Users can set values of <span class="math inline">\(\sigma_{niche,min}\)</span> and <span class="math inline">\(\sigma_{niche,max}\)</span> using
<code>min_niche_width</code> and <code>max_niche_width</code> arguments
(default: <code>min_niche_width = 0.1</code> and
<code>max_niche_width = 1</code>). If a single value or a vector of
<code>sd_niche_width</code> is provided, the function ignores
<code>min_niche_width</code> and <code>max_niche_width</code>
arguments.</p>
<p>The argument <code>niche_cost</code> determines the cost of having
wider niche. Smaller values imply greater costs of wider niche (i.e.,
decreased maximum reproductive rate; default:
<code>niche_cost = 1</code>). To disable (no cost of wide niche), set
<code>niche_cost = Inf</code>.</p>
<p>For other parameters, users may specify species attributes by giving
a scalar (assume identical among species) or a vector of values whose
length must be one or equal to <code>n_species</code>. Default values
are <code>r0 = 4</code>, <code>sd_niche_width = 1</code>, and
<code>p_dispersal = 0.1</code>.</p>
</div>
<div class="section level4">
<h4 id="competition">Competition<a class="anchor" aria-label="anchor" href="#competition"></a>
</h4>
<p><strong>Arguments:</strong> <code>interaction_type</code>,
<code>alpha</code> OR <code>min_alpha</code> and
<code>max_alpha</code></p>
<p>The argument <code>interaction_type</code> determines whether
interaction coefficient <code>alpha</code> is a constant or random
variable. If <code>interaction_type = "constant"</code>, then the
interaction coefficients <span class="math inline">\(\alpha_{ij, i \ne
j}\)</span> for any pairs of species will be set as a constant
<code>alpha</code> (i.e., off-diagonal elements of the interaction
matrix). If <code>interaction_type = "random"</code>, <span class="math inline">\(\alpha_{ij, i \ne j}\)</span> will be drawn from a
uniform distribution as <span class="math inline">\(\alpha_{ij, i \ne j}
\sim Unif(\alpha_{min}, \alpha_{max})\)</span> with corresponding
arguments <code>min_alpha</code> and <code>max_alpha</code>. The
argument <code>alpha</code> is ignored under the scenario of random
interaction strength (i.e., <code>interaction_type = "random"</code>).
Note that the diagonal elements of the interaction matrix (<span class="math inline">\(\alpha_{ii}\)</span>) are always 1.0 regardless of
<code>interaction_type</code>, as <code>alpha</code> is the strength of
interspecific competition relative to that of intraspecific competition
(see <strong>Model description</strong>). By default,
<code>interaction_type = "constant"</code> and
<code>alpha = 0</code>.</p>
</div>
<div class="section level4">
<h4 id="patch-attributes">Patch attributes<a class="anchor" aria-label="anchor" href="#patch-attributes"></a>
</h4>
<p><strong>Arguments:</strong> <code>carrying_capacity</code>,
<code>mean_env</code>, <code>sd_env</code>,
<code>spatial_auto_cor</code>, <code>phi</code></p>
<p>The arguments <code>carrying_capacity</code> (default:
<code>carrying_capacity = 100</code>) and <code>mean_env</code>
(default: <code>mean_env = 0</code>) determines mean attributes of
habitat patches, which can be a scalar (assume identical among patches)
or a vector (length must be equal to <code>n_patch</code>).</p>
<p>The arguments <code>sd_env</code> (default:
<code>sd_env = 0.1</code>), <code>spatial_auto_cor</code> (default:
<code>spatial_auto_cor = FALSE</code>) and <code>phi</code> (default:
<code>phi = 1</code>) determine spatio-temporal dynamics of
environmental values. <code>sd_env</code> determines the magnitude of
temporal environmental fluctuations. If
<code>spatial_auto_cor = TRUE</code>, the function models spatial
autocorrelation of temporal environmental fluctuation based on a
multi-variate normal distribution. The degree of spatial autocorrelation
would be determined by <code>phi</code>, the parameter describing the
strength of distance decay in spatial autocorrelation (see <strong>Model
description</strong>).</p>
</div>
<div class="section level4">
<h4 id="landscape-structure">Landscape structure<a class="anchor" aria-label="anchor" href="#landscape-structure"></a>
</h4>
<p><strong>Arguments:</strong> <code>xy_coord</code> OR
<code>distance_matrix</code>, <code>landscape_size</code>,
<code>theta</code></p>
<p>These arguments define landscape structure. By default, the function
produces a square-shaped landscape (<code>landscape_size = 10</code> on
a side) in which habitat patches are distributed randomly through a
Poisson point process (i.e., x- and y-coordinates of patches are drawn
from a uniform distribution). The parameter θ describes the shape of
distance decay in species dispersal (see <strong>Model
description</strong>) and determines patches’ structural connectivity
(default: <code>theta = 1</code>). Users can define their landscape by
providing either <code>xy_coord</code> or <code>distance_matrix</code>
(<code>landscape_size</code> will be ignored if either of these
arguments is provided). If <code>xy_coord</code> is provided (2-column
data frame denoting x- and y-coordinates of patches, respectively;
<code>NULL</code> by default), the function calculates the distance
between patches based on coordinates. Alternatively, users may provide
<code>distance_matrix</code> (the object must be <code>matrix</code>),
which describes the distance between habitat patches. The argument
<code>distance_matrix</code> overrides <code>xy_coord</code>.</p>
</div>
<div class="section level4">
<h4 id="others">Others<a class="anchor" aria-label="anchor" href="#others"></a>
</h4>
<p><strong>Arguments:</strong> <code>n_warmup</code>,
<code>n_burnin</code>, <code>n_timestep</code></p>
<p>The argument <code>n_warmup</code> is the period during which species
introductions occur (default: <code>n_warmup = 200</code>). The initial
number of individuals introduced follows a Poisson distribution with a
mean of 0.5 and independent across space and time. This random
introduction events occur multiple times over the <code>n_warmup</code>
period, in which <code>propagule_interval</code> determines the timestep
interval of the random introductions (default:
<code>propagule_interval = ceiling(n_warmup / 10)</code>).</p>
<p>The argument <code>n_burnin</code> is the period that will be
discarded as <em>burn-in</em> to remove the influence of initial values
(default: <code>n_burnin = 200</code>). During the burn-in period,
species introductions do not occur.</p>
<p>The argument <code>n_timestep</code> is the simulation peiord that is
recorded in the return <code>df_dynamics</code> (default:
<code>n_timestep = 1000</code>). As a result, with the default setting,
the function simulates 1400 timesteps (<code>n_warmup</code> +
<code>n_burnin</code> + <code>n_timestep</code> = 1400) but returns only
the last 1000 timesteps as the resulting metacommunity dynamics. All the
derived statistics (e.g., diversity metrics in <code>df_diversity</code>
and <code>df_patch</code>) will be calculated based on the results
during <code>n_timestep</code>.</p>
</div>
</div>
<div class="section level3">
<h3 id="model-description">Model description<a class="anchor" aria-label="anchor" href="#model-description"></a>
</h3>
<p>Full model descriptions are available at: <a href="https://doi.org/10.1073/pnas.2105574118" class="external-link uri">https://doi.org/10.1073/pnas.2105574118</a></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Akira Terui.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a>
2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
